<section *ngIf="data && data.serviceRegistration">
  <button class="btn btn-sm" id="cost-btn"
    (click)="generateEmergencyEstimationReport()">Download
  </button>
  <form class="form" id="printForm">
    <div class="col-lg-6 mt-4" style="width: 100% !important; padding: 1rem">
      <div class="heading" style="background-color: #f0f0f0">
        <h1>Cost Estimation Report</h1>
      </div>
    </div>
    <div class="two-row-grid single-row-grid mt-3" style="padding: 1rem">
      <div class="left-div" *ngFor="let item of data.estimationRegisteredDTO">
        <div class="inner-div">
          <label>Dop Category</label>
          <p>{{ workCategoryName }}
          </p>
        </div>
        <div class="inner-div">
          <label>Work Execution Method</label> 
          <p>{{ getWorkExecutionName(item.workExecutionMethod) }}</p>
        </div>
        <div class="inner-div">
          <label>Estimation No</label>
          <p>{{ item.estimationNo }}</p>
        </div>
        <div class="inner-div">
          <label>Estimation Date</label>
          <p>{{ item.estimationDate | date : "medium" }}</p>
        </div>
        <div class="inner-div">
          <label>Purpose of Estimate</label>
          <p>{{ item.estimationWorkDesc }}</p>
        </div>
        <div class="inner-div">
          <label>Suspense Request No.</label>
          <p>{{ item?.suspenseRequestNo == null ? '-' : item.suspenseRequestNo }}
          </p>
        </div>
      </div>
    </div>

    <div style="border: 2px solid #e1e1e1; padding: 1rem">
      <h2 style="background-color: #f0f0f0">Regularization</h2>
      <div class="heading mt-2" *ngFor="let e of regularizationArray">
        <div style="background-color: #f0f0f0">
          <h3>
            {{ e.estimate.workType }}- {{ e.estimate.workPart }}-
            {{ e.estimate.workscopeDescription }}
          </h3>
        </div>

        <div style="display: flex; flex-wrap: wrap; overflow: auto">
          <table
            class="table text-center"
            style="margin-top: 1rem; width: 100%; flex-wrap: wrap"
          >
            <thead>
              <tr>
                <th scope="col">Rate Type</th>
                <th scope="col">Description of Material</th>
                <th scope="col">Quantity</th>
                <th scope="col">Unit</th>
                <th scope="col">Rate</th>
                <th scope="col">Materials Amount</th>
                <th scope="col">Labour Rate</th>
                <th scope="col">Labour Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of e.data">
                <td>{{ item.rateType }}</td>
                <td style="text-align: left">
                  {{ item.materialCode }} - {{ item.materialName }}
                </td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.materialUnit }}</td>
                <td>{{ item.materialRate }}</td>
                <td>{{ item.materailAmount }}</td>
                <td>{{ item.labourRate }}</td>
                <td>{{ item.labourAmount }}</td>
              </tr>
            </tbody>
            <tr>
              <td>
                <h4><strong>Total</strong></h4>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>{{ e.estimate.materialCost }}</td>
              <td></td>
              <td>{{ e.estimate.labourCost }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <!-- Typical Cost Data Sheet -->
    <div class="col-lg-6 mt-4" style="width: 100% !important; padding: 1rem">
      <div class="heading" style="background-color: #f0f0f0">
        <h2>Typical Cost Data Sheet</h2>
      </div>

      <div class="two-row-grid mt-3" style="grid-template-columns: 1fr;justify-items: flex-end;border: 2px solid #f0f0f0;padding: 1rem;">
        <div class="data-sheet">
          <div class="inner-div-t">
            <label>Material Cost (A)</label>
            <p>
              {{ data.estimationRegisteredDTO[0]?.estimationMaterialCost }}
            </p>
          </div>
          <div class="inner-div-t">
            <label>Labour Cost (B)</label>
            <p>
              {{ data.estimationRegisteredDTO[0]?.estimationLabourCost }}
            </p>
          </div>
          <div class="inner-div-t">
            <label>Basic Rate (C)=(A+B)</label>
            <p>
              {{basicRate}}
            </p>
          </div>
          <div class="inner-div-t" *ngFor="let item of addChargesBeforeTotalLabour">
            <label>
                <ng-container *ngIf="item.chargeType == 'PERCENTAGE'">
                    {{ item.chargeTypeValue }}% {{ item.additionalChargeName }}
                </ng-container>
                <ng-container *ngIf="item.chargeType == 'FLAT'">
                    {{ item.additionalChargeName }}
                </ng-container>
                <span *ngIf="item.additionalChargeName === 'Area Specific Loading on Basic Rates'">(D)</span>
                <span *ngIf="item.additionalChargeName === 'GST'">(E)</span>
            </label>
            <p>{{ item.amount }}</p>
        </div>     
          <div class="inner-div-t">
            <label>Total Labour Charges (F) = (C + D + E)</label>
            <p>{{ data.estimationRegisteredDTO[0]?.totalLabourCharges }}</p>
          </div>
          <div class="inner-div-t" *ngFor="let item of addChargesAfterTotalLabour">
            <label *ngIf="item.chargeType == 'PERCENTAGE'">{{ item.chargeTypeValue }}%
              {{ item.additionalChargeName }}</label>
            <label *ngIf="item.chargeType == 'FLAT'">{{
              item.additionalChargeName
              }}</label>
            <p>{{ item.amount }}</p>
          </div>
          <div class="inner-div-t">
            <label style="font-weight: bold;">Total Estimate Amount (F + Sum of all charges below F)</label>
            <p>{{ data?.estimationRegisteredDTO[0]?.estimationTotalCost }}</p>
          </div>
        </div>
       
      </div>
    </div>

    <!-- Budget Details -->
    <div
      *ngIf="data.accountHeadMasterId"
      class="heading"
      style="
        background-color: #f0f0f0;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        padding: 0 2rem;
      "
    >
      <h2>Budget Details</h2>
    </div>
    <p
      *ngIf="
        grandTotal >
        divisionalBudgetData?.totalBudgetAmount -
          divisionalBudgetData?.workOrderIssueAmount
      "
      style="color: red; padding: 0.2rem"
    >
      Total Amount is greater than Balance Amount
    </p>
    <div
      class="col-lg-6 mt-4"
      style="width: 100% !important; padding: 0.5rem"
      *ngIf="data.accountHeadMasterId"
    >
      <div class="grid two-row-grid mt-4">
        <div class="left-div">
          <div class="inner-div">
            <label>Divisional Acc. Head No.*</label>
            <p>-</p>
          </div>
          <div class="inner-div">
            <label>Divisional Acc. Head Description</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.accountHeadDescription }}
            </p>
          </div>
          <div class="inner-div">
            <label>Division Budget Head</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.divisionalBudgetHead }}
            </p>
          </div>
          <div class="inner-div">
            <label>Budget Type</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.budgetWorkType }}
            </p>
          </div>
        </div>
        <div>
          <div class="inner-div">
            <label>Total Budget Amount</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.totalBudgetAmount }}
            </p>
          </div>
          <div class="inner-div">
            <label>Work Order issue Amount</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.workOrderIssueAmount }}
            </p>
          </div>
          <div class="inner-div">
            <label>Balance Amount</label>
            <p>
              {{ balanceAmount }}
            </p>
          </div>
        </div>
      </div>
    </div>
    <!-- Labour Details -->
    <div
      class="heading"
      style="
        background-color: #f0f0f0;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        padding: 0 2rem;
      "
    >
      <h2>Labour Details</h2>
    </div>

    <div
      style="
        display: flex;
        flex-wrap: wrap;
        overflow: auto;
        border: 2px solid#E1E1E1;
      "
    >
      <table
        class="table text-center"
        style="margin-top: 1rem; width: 100%; flex-wrap: wrap"
      >
        <thead>
          <tr>
            <th scope="col">Description of Material</th>
            <th scope="col">Description of Labours</th>
            <th scope="col">Unit</th>
            <th scope="col">Labour Rate</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let labourDetail of labourDetails">
            <td>{{ labourDetail.materialName }}</td>
            <td>{{ labourDetail.labourName }}</td>
            <td>{{ labourDetail.labourUnit }}</td>
            <td>{{ labourDetail.labourRate }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div></div>

    <br /><br />
  </form>
</section>
