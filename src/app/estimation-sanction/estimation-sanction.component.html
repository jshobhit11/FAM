<div class="page-1">
  <section class="mt-2">
    <ul>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a routerLink="/main/dashboard">Dashboard </a>
          </li>
          <li class="breadcrumb-item">
            <a routerLink (click)="navigate()">Estimation Sanction</a>
          </li>
          <li class="breadcrumb-item">
            <a style="color: lightslategray">Estimation Sanction Form</a>
          </li>
        </ol>
      </nav>
    </ul>
  </section>
  <section *ngIf="data && data.serviceRegistration">
    <!-- <button
      class="btn btn-sm"
      style="background-color: #4472c4; color: white; float: right"
      (click)="printPageArea('printForm')"
    >
      Print
    </button> -->
    <form class="form" id="printForm"  [formGroup]="estimationSanctionForm">
      <div class="page__content shadow p-3 position-relative dis-flex-colu">
        <h2 class="title-2"> Estimation Sanction Form </h2>
  
        <!-- <div class="two-row-grid mt-4"> -->
          <div class="left-div">
            <div class="inner-div">
              <label>Account ID</label>
              <p>{{ data.serviceRegistration.accountId }}</p>
            </div>
            <div class="inner-div">
              <label>Name & Address</label>
              <p>
                {{ data.serviceRegistration.applicantName }} ,
                {{ data.serviceRegistration.address }}
              </p>
            </div>
            <div class="inner-div">
              <label>Application Category</label>
              <p>{{ data.serviceRegistration.categoryCode }}</p>
            </div>
            <div class="inner-div">
              <label>Email ID</label>
              <p>
                {{
                  data.serviceRegistration.email !== "null"
                    ? data.serviceRegistration.email
                    : "-"
                }}
              </p>
            </div>
            <div class="inner-div">
              <label>Contact No.</label>
              <p>
                {{
                  data.serviceRegistration.mobile !== "null"
                    ? data.serviceRegistration.mobile
                    : "-"
                }}
              </p>
            </div>
            <div class="inner-div">
              <label>Applicant Type</label>
              <p>{{ data.serviceRegistration.applicantType=== "null" ? '-' :data.serviceRegistration.applicantType }}</p>
            </div>
            <div class="inner-div">
              <label>Application Type</label>
              <p>{{ data.serviceRegistration.connectionType === "null" ? '-' : data.serviceRegistration.connectionType}}</p>
            </div>
            <div class="inner-div">
              <label>Tariff Classification & Nature of Services</label>
              <p>{{ data.serviceRegistration.tariff }}</p>
            </div>
          </div>
          <div>
            <div class="inner-div">
              <label>Service Category</label>
              <p>Others</p>
            </div>
            <div class="inner-div">
              <label>Applied Load (KW)</label>
              <p>{{ data.serviceRegistration.loadKw }}</p>
            </div>
            <div class="inner-div">
              <label>Applied Load (HP)</label>
              <p>{{ data.serviceRegistration.loadHp }}</p>
            </div>
            <div class="inner-div">
              <label>Total Load / Phase</label>
              <p>
                {{ data.serviceRegistration.totalContractedLoad }}
                {{ data.serviceRegistration.loadUnit }} /
                {{ data.serviceRegistration.phase }} Phase
              </p>
            </div>
            <div class="inner-div">
              <label>Location Type</label>
              <p>{{ data.serviceRegistration.officeName }}</p>
            </div>
            <div class="inner-div">
              <label>Adjacent Account ID</label>
              <p>{{ data.serviceRegistration.serviceRegistrationId }}</p>
            </div>
            <div class="inner-div">
              <label>Buildup Area </label>
              <p>
                {{ data.serviceRegistration.buildupAreaSize }}
              </p>
            </div>
          </div>
        <!-- </div> -->
      
  
      <!-- Cost estimation report  -->
  
      <div class="page__content  position-relative dis-flex-colu">
        <h2 class="title-2">Cost Estimation Report </h2>
  
  
      <!-- <div class="two-row-grid single-row-grid mt-3" style="padding: 1rem"> -->
        <div class="left-div" *ngFor="let item of data.estimationRegisteredDTO">
          <!-- <div class="inner-div">
            <label>Name & Address</label>
            <p>{{ data.serviceRegistration.applicantName }} , {{ data.serviceRegistration.address }}</p>
          </div> -->
          <div class="inner-div">
            <label>Dop Category</label>
            <p>{{ workCategoryName ? workCategoryName : "-" }}</p>
          </div>
          <div class="inner-div">
            <label>Work Execution Method</label>
            <p>
              {{
                item.woExecutionMethodName === "null"
                  ? "-"
                  : item.woExecutionMethodName
              }}
            </p>
          </div>
          <div class="inner-div">
            <label>Estimation No</label>
            <p>{{ item.estimationNo === "null" ? "-" : item.estimationNo }}</p>
          </div>
          <div class="inner-div">
            <label>Estimation Date</label>
            <p>
              {{ item.estimationDate === "null" ? "-" : item.estimationDate }}
            </p>
          </div>
          <div class="inner-div">
            <label>Purpose of Estimate</label>
            <p>
              {{
                item.estimationWorkDesc === "null" ? "-" : item.estimationWorkDesc
              }}
            </p>
          </div>
        </div>
      <!-- </div> -->
  
      <!-- LT-Part A -Extension of LT line  -->
      <div class="page__content  position-relative dis-flex-colu">
        <h2 class="title-2"> Regular </h2>
        <div class="heading mt-2" *ngFor="let e of regularArray">
          <div>
            <h1>
              {{ e.estimate.workType }}- {{ e.estimate.workPart }}-
              {{ e.estimate.workscopeDescription }}
            </h1>
          </div>
  
          <div style="display: flex; flex-wrap: wrap; overflow: auto">
            <table
              class="table text-center"
              style="margin-top: 1rem; width: 100%; flex-wrap: wrap"
            >
              <thead>
                <tr>
                  <th scope="col">Rate Type</th>
                  <th scope="col">Description of Material</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Unit</th>
                  <th scope="col">Rate</th>
                  <th scope="col">Materials Amount</th>
                  <th scope="col">Labour Rate</th>
                  <th scope="col">Labour Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of e.data">
                  <td>{{ item.rateType }}</td>
                  <td style="text-align: left">
                    {{ item.materialCode }} - {{ item.materialName }}
                  </td>
                  <td>{{ item.quantity }}</td>
                  <td>{{ item.materialUnit }}</td>
                  <td>{{ item.materialRate }}</td>
                  <td>{{ item.materailAmount }}</td>
                  <td>{{ item.labourRate }}</td>
                  <td>{{ item.labourAmount }}</td>
                </tr>
              </tbody>
              <tr>
                <td>
                  <h1>Total</h1>
                </td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{ e.estimate.materialCost }}</td>
                <td></td>
                <td>{{ e.estimate.labourCost }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      <div
        *ngIf="creditArray.length"
      
      >
        <h2>Credit</h2>
        <div class="heading mt-2" *ngFor="let e of creditArray; index as i">
          <div>
            <div>
              <h1>
                {{ e.estimate.workType }}- {{ e.estimate.workPart }}-
                {{ e.estimate.workscopeDescription }}
              </h1>
            </div>
            <p>
              Code :
              {{
                getAccountHeadDetails(e.estimate.accountHeadMasterId)
                  ?.accountHeadCode
              }}
            </p>
            <p>
              Description :
              {{
                getAccountHeadDetails(e.estimate.accountHeadMasterId)
                  ?.accountHeadDescription
              }}
            </p>
            <!-- <div class="col" style="background-color: #f0f0f0">
              <h3>Code : {{ getAccountHeadDetails(e.estimate.accountHeadMasterId).accountHeadCode }}</h3>
              <h3>Description : {{ getAccountHeadDetails(e.estimate.accountHeadMasterId).accountHeadDescription }}</h3>
            </div> -->
            <!-- <select
                  class="form-select float-end"
                  name="creditAccountHead"
                  style="width: 100%"
                  (change)="creditAccountHead($event.target.value, i)"
                >
                  <option>Select Account Head</option>
                  <option
                    *ngFor="let accountHeadDataItem of creditAccountHeadData"
                    [value]="accountHeadDataItem.accountHeadMasterId"
                  >
                    {{ accountHeadDataItem?.accountHeadCode }}&nbsp;({{
                      accountHeadDataItem?.accountHeadDescription
                    }})
                  </option>
                </select> -->
          </div>
  
          <div style="display: flex; flex-wrap: wrap; overflow: auto">
            <table
              class="table text-center"
              style="margin-top: 1rem; width: 100%; flex-wrap: wrap"
            >
              <thead>
                <tr>
                  <th scope="col">Rate Type</th>
                  <th scope="col">Description of Material</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Unit</th>
                  <th scope="col">Rate</th>
                  <th scope="col">Materials Amount</th>
                  <th scope="col">Labour Rate</th>
                  <th scope="col">Labour Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of e.data">
                  <td>{{ item.rateType }}</td>
                  <td style="text-align: left">
                    {{ item.materialCode }} - {{ item.materialName }}
                  </td>
                  <td>{{ item.quantity }}</td>
                  <td>{{ item.materialUnit }}</td>
                  <td>{{ item.materialRate }}</td>
                  <td>{{ item.materailAmount }}</td>
                  <td>{{ item.labourRate==='null'?0:item.labourRate}}</td>
                  <td>{{ item.labourAmount ==='null'?0 :item.labourAmount }}</td>
                </tr>
              </tbody>
              <tr>
                <td>
                  <h1>Total</h1>
                </td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{ e.estimate.materialCost }}</td>
                <td></td>
                <td>{{ e.estimate.labourCost ==='null'?0:e.estimate.labourCost }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
  
      <!-- Typical Cost Data Sheet -->
  
     <div class="page__content  position-relative dis-flex-colu">
        <h2 class="title-2"> Typical Cost Data Sheet </h2>
  
        <div
          class="two-row-grid"
          style="
            grid-template-columns: 1fr;
            justify-items: flex-end;
          
            padding: 1rem;
          "
        >
          <div class="data-sheet">
            <div class="inner-div-t" *ngIf="data.estimationRegisteredDTO[0]?.woExecutionMethodCode=== 'PT'">
              <label>Escom Material Cost (A)</label>
              <p>
                {{ data.estimationRegisteredDTO[0]?.escomMaterialCost }}
              </p>
            </div>
            <div class="inner-div-t" *ngIf="data.estimationRegisteredDTO[0]?.woExecutionMethodCode=== 'PT'" >
              <label>Agency Material Cost (B)</label>
              <p>
                {{ data.estimationRegisteredDTO[0]?.agencyMaterialCost }}
              </p>
            </div>
            <div class="inner-div-t">
              <label>Material Cost (A)</label>
              <p>
                {{ data.estimationRegisteredDTO[0]?.estimationMaterialCost }}
              </p>
            </div>
            <div class="inner-div-t">
              <label>Labour Cost (B)</label>
              <p>
                {{ data.estimationRegisteredDTO[0]?.estimationLabourCost }}
              </p>
            </div>
            <div class="inner-div-t">
              <label>Basic Rate (C)=(A+B)</label>
              <p>
                {{ basicRate}}
              </p>
            </div>
            <div class="inner-div-t" *ngFor="let item of addChargesBeforeTotalLabour">
              <label>
                  <ng-container *ngIf="item.chargeType == 'PERCENTAGE'">
                      {{ item.chargeTypeValue }}% {{ item.additionalChargeName }}
                  </ng-container>
                  <ng-container *ngIf="item.chargeType == 'FLAT'">
                      {{ item.additionalChargeName }}
                  </ng-container>
                  <span *ngIf="item.additionalChargeName === 'Area Specific Loading on Basic Rates'">(D)</span>
                  <span *ngIf="item.additionalChargeName === 'GST'">(E)</span>
              </label>
              <p>{{ item.amount }}</p>
          </div>
            <div class="inner-div-t">
              <label>Cost Of Estimate (F) = (C + D + E)</label>
              <p>
                {{ data.estimationRegisteredDTO[0]?.totalLabourCharges ==='null'?0:data.estimationRegisteredDTO[0]?.totalLabourCharges }}
              </p>
            </div>
            <div
              class="inner-div-t"
              *ngFor="let item of addChargesAfterTotalLabour"
            >
              <label *ngIf="item.chargeType == 'PERCENTAGE'"
                >{{ item.chargeTypeValue }}%
                {{ item.additionalChargeName }}</label
              >
              <label *ngIf="item.chargeType == 'FLAT'">{{
                item.additionalChargeName
              }}</label>
              <p>{{ item.amount }}</p>
            </div>
            <div class="inner-div-t">
              <label><strong>Total Cost Of Estimate (F + Sum of all charges below F)</strong></label>
              <p>
               <strong>{{ data?.estimationRegisteredDTO[0]?.estimationTotalCost }}</strong>
              </p>
            </div>
            <div class="inner-div-t">
              <label>(Amount in Words)</label>
              <p>
                {{ data?.estimationRegisteredDTO[0]?.estimationTotalCost |numberToWords}}
              </p>
            </div>
            <!-- <div class="inner-div-t" *ngIf="data.serviceRegistration?.connectionCode==='JVS'">
              <label>MSD Amount</label>
              <p>
                {{ data.estimationRegisteredDTO[0]?.msdAmount }}
              </p>
            </div> -->
          </div>
        </div>
      </div>
  
      <!-- Budget Details -->
      <div class="page__content  position-relative dis-flex-colu"
        *ngIf="isBudgetDetails"
      >
        <h2 class="title-2">Budget Details</h2>
      </div>
      <div *ngIf="isBudgetDetails">
        <div
          class="col-lg-6 mt-2"
          style="width: 100% !important; padding: 0.5rem"
        >
          <div class="grid two-row-grid">
            <div class="left-div">
              <div class="inner-div">
                <label>Divisional Acc. Head No. <span class="star">*</span></label>
                <select
                  class="form-select"
                  name="budget"
                  style="width: 100%"
                  [formControl]="budgetControl"
                  (change)="getDivisionalBudgetData($event.target.value)"
                  formControlName="budgetControl"
                >
                  <option selected *ngIf="!selectedValue">--select--</option>
                  <option selected *ngIf="selectedValue">
                    {{ selectedValue }}
                  </option>
                  <option
                    *ngFor="let data of budgetData"
                    [value]="data.accountHeadMasterId"
                  >
                    {{ data?.accountHeadCode }}&nbsp;({{
                      data?.accountHeadDescription
                    }})
                  </option>
                </select>
              </div>
              <mat-error class="date" *ngIf="estimationSanctionForm.get('budgetControl').hasError('required') && estimationSanctionForm.get('budgetControl').touched">
                Please select this field.
              </mat-error>
              <div class="inner-div">
                <label>Divisional Acc. Head Description</label>
                <p>{{ divisionalBudgetData?.accountHeadDescription }}</p>
              </div>
              <div class="inner-div">
                <label>Division Budget Head</label>
                <p>{{ divisionalBudgetData?.divisionalBudgetHead }}</p>
              </div>
              <div class="inner-div">
                <label>Budget Type</label>
                <p>{{ divisionalBudgetData?.budgetWorkType }}</p>
              </div>
            </div>
            <div>
              <div class="inner-div">
                <label>Total Budget Amount (A)</label>
                <p>{{ divisionalBudgetData?.totalBudgetAmount }}</p>
              </div>
              <div class="inner-div">
                <label>Work Order issue Amount (B)</label>
                <p>
                  {{
                    divisionalBudgetData?.workOrderIssueAmount != "null"
                      ? divisionalBudgetData?.workOrderIssueAmount
                      : "-"
                  }}
                </p>
              </div>
              <div class="inner-div">
                <label>Reserved Amount (C)</label>
                <p>
                  {{ divisionalBudgetData?.totalReserveAmount != 'null' ? 
                      divisionalBudgetData?.totalReserveAmount : '-' }}
                </p>
              </div>
              <div class="inner-div">
                <label>Balance Amount ( A - ( B + C) )</label>
                <p>
                  {{ divisionalBudgetData?.balanceAmount ? divisionalBudgetData?.balanceAmount : '-' }}
                </p>
              </div>
              <div class="inner-div">
                <label>Total Expenditure Amount (D)</label>
                <p>
                  {{ divisionalBudgetData?.totalExpenditureAmount != 'null' ? 
                      divisionalBudgetData?.totalExpenditureAmount : '0' }}
                </p>
              </div>
              <div class="inner-div">
                <label>Actual Balance Amount (A - D)</label>
                <p>
                  {{ divisionalBudgetData?.totalBudgetAmount - divisionalBudgetData?.totalExpenditureAmount || 
                    divisionalBudgetData?.totalBudgetAmount - divisionalBudgetData?.totalExpenditureAmount == 0 ? 
                    divisionalBudgetData?.totalBudgetAmount - divisionalBudgetData?.totalExpenditureAmount : '-' }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Labour Details -->
  
      <div
        class="heading"
        style="
          flex-direction: row;
          justify-content: space-between;
        
        "
      >
        <h2>
          Labour Details &nbsp;
          <button style="border: none" (click)="toggleDisplayTableIf()">
            <img src="assets/plus.svg" alt="" />
          </button>
        </h2>
      </div>
  
      <div
        style="
          flex-wrap: wrap;
          overflow: auto;
    
        "
        *ngIf="!toggleTable"
      >
        <!-- [ngStyle]="{ display: toggleTable ? 'none' : '' }" -->
        <table
          class="table text-center"
          style="margin-top: 1rem; width: 100%; flex-wrap: wrap"
        >
          <thead style="background-color: #dfdfdf">
            <tr>
              <th scope="col">Description of Material</th>
              <th scope="col">Description of Labours</th>
              <th scope="col">Unit</th>
              <th scope="col">Labour Rate</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let labourDetail of labourDetails">
              <td>{{ labourDetail.materialName }}</td>
              <td>{{ labourDetail.labourName }}</td>
              <td>{{ labourDetail.labourUnit }}</td>
              <td>{{ labourDetail.labourRate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div></div>
  
      <br /><br />
      <div
        class="heading"
        style="
          
          
          flex-direction: row;
          justify-content: space-between;
          padding: 0 2rem;
        "
      >
        <h2>History</h2>
      </div>
  
      <div
        style="
          display: flex;
          flex-wrap: wrap;
          overflow: auto;
        
        "
      >
        <table class="table text-center" style="margin-top: 1rem; width: 100%; flex-wrap: wrap">
          <thead style="background-color: #dfdfdf">
            <tr>
              <th>S. No.</th>
              <th scope="col">PROCESS TYPE</th>
              <th scope="col">PROCESSED DATE</th>
              <th scope="col">PROCESSED BY</th>
              <th scope="col">FORWARD/RETURN TO</th>
              <th scope="col">REMARKS</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let historyData of history?.estimationProcessFlowHistory; index as i"
            [ngStyle]="{'background-color': historyData.estimationStatus === '1' && historyData.estimationFlowType === 'REGENERATED' ? '#ffd8fe' : 'none'}">
              <td>{{ i + 1 }}</td>
              <td>
                <b *ngIf="historyData.estimationFlowType == 'GENERATED' || historyData.estimationFlowType == 'REGENERATED'">
                  <a target="_blank" 
                  routerLink="/main/estimation-report/{{historyData.estimationRegisteredId}}/{{ data.serviceRegistration.serviceRegistrationId }}">
                  {{ historyData.estimationFlowType }}</a>
                </b>
                <b *ngIf="historyData.estimationFlowType != 'GENERATED' && historyData.estimationFlowType != 'REGENERATED'">
                  {{ historyData.estimationFlowType }}
                </b>
              </td>
              <td>{{ historyData.processedDate | date : "medium" }}</td>
              <td>{{ historyData.processedByDesigcode }}</td>
              <td>{{ historyData.processSendToDesigcode !== "null" ? historyData.processSendToDesigcode : '-' }}</td>
              <td>{{ historyData?.remarks }}</td>
            </tr>
          </tbody>
        </table>
      </div>
  
      <div></div>
      <br /><br />
      <div
        class="heading"
        style="
          display: flex;
          flex-direction: row;
          justify-content: space-between;
  
        "
      >
        <h2>Approve</h2>
      </div>
      <!-- Radio btns -->
  
      <div
        style="
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          gap: 2rem;
          justify-content: center;
          padding: 0.5rem;
        "
      >
        <!-- <label style="font-size: 20px; font-weight: 500">
      <input [(ngModel)]="isApprovePowerSanction" name="isApprovePowerSanction" type="checkbox" />
      Click on checkbox to approve the Power Sanction
    </label> -->
      </div>
  
      <div class="text-center purple">
        <div class="container text-center">
          <div class="row">
            <div
              class="col"
              style="display: flex; flex-direction: column; gap: 2rem"
            >
              <h4>Approve By <span class="star"> *</span></h4>
              <h4>Approve Date <span class="star"> *</span></h4>
              <h4>Remarks <span class="star"> *</span></h4>
            </div>
            <div
              class="col"
              style="display: flex; flex-direction: column; gap: 2rem"
            >
              <input
                type="text"
                class="form-control"
                style="width: 80%"
                id=""
                name="forwardBy"
                [(ngModel)]="forwardData.forwardBy"
                formControlName="forwardBy"
                appAlphaNumeric
                [maxLength]="30"
              />
              <mat-error class="errordata"  *ngIf="estimationSanctionForm.get('forwardBy').hasError('required') && estimationSanctionForm.get('forwardBy').touched">
                Please fill in this field.
              </mat-error>
        
              <input
                type="date"
                class="form-control"
                style="width: 80%"
                id=""
                name="forwardDate"
                [(ngModel)]="forwardData.forwardDate"
                formControlName="forwardDate"
              />
              <mat-error class="errordata" *ngIf="estimationSanctionForm.get('forwardDate').hasError('required') && estimationSanctionForm.get('forwardDate').touched">
                Please select this field.
              </mat-error>
              <textarea
                type="text"
                class="form-control"
                style="width: 80%"
                id=""
                name="Remarks"
                [(ngModel)]="forwardData.Remarks"
                formControlName="Remarks"
                appAlphaNumeric
                [maxLength]="300"
              ></textarea>
              <mat-error class="errordata" *ngIf="estimationSanctionForm.get('Remarks').hasError('required') && estimationSanctionForm.get('Remarks').touched">
                Please fill in this field.
              </mat-error>
            </div>
          </div>
        </div>
        <div class="radio-button">
          <button
            [disabled]="isLoading"
            class="btn btn-md center-btn radio-button"
            style="background-color: #4472c4; color: white"
            (click)="openApproveDialog()"
          >
            Approve
          </button>
        </div>
      </div>
      </div>
    </div>
    </form>
  </section>
  </div>