<div class="page-1">
<div class="page__content mt-4 shadow p-3 position-relative dis-flex-colu">
<section *ngIf="data && data.serviceRegistration">
  <button class="btn btn-sm"
    style="background-color: #4472c4; color: white; float: right "
    (click)="generateWorkOrderReport()">Download
  </button>
  <form class="form" id="printForm">
    <div class="col-lg-6 mt-4" style="width: 100% !important; ">
      <div class="heading">
        <h2>Cost Estimation Report </h2>
      </div>

      <div class="two-row-grid mt-4" *ngIf="data.serviceRegistration?.applicationTypeCode !== 'BMR' && data.serviceRegistration?.applicationTypeCode !== 'QMOM'&& data.serviceRegistration?.applicationTypeCode !== 'QMMT'; else bmrContent">
        <div class="left-div">
          <div class="inner-div">
            <label>Account ID</label>
            <p>{{ data.serviceRegistration.accountId=='null'?'-':data.serviceRegistration.accountId}}</p>
          </div>
          <div class="inner-div">
            <label>Name & Address</label>
            <p>
              {{ data.serviceRegistration.applicantName =='null'?'-':data.serviceRegistration.applicantName}} ,
              {{ data.serviceRegistration.address =='null'?'-':data.serviceRegistration.address }}
            </p>
          </div>
          <div class="inner-div">
            <label>Application Category</label>
            <p>{{ data.serviceRegistration.categoryCode ==='null'?'-':data.serviceRegistration.categoryCode  }}</p>
          </div>
          <div class="inner-div">
            <label>Email ID</label>
            <p>
              {{
                data.serviceRegistration.email !== "null"
                  ? data.serviceRegistration.email
                  : "-"
              }}
            </p>
          </div>
          <div class="inner-div">
            <label>Contact No.</label>
            <p>
              {{
                data.serviceRegistration.mobile !== "null"
                  ? data.serviceRegistration.mobile
                  : "-"
              }}
            </p>
          </div>
          <div class="inner-div">
            <label>Applicant Type</label>
            <p>{{ data.serviceRegistration.applicantType === "null"?'-':data.serviceRegistration.applicantType}}</p>
          </div>
          <div class="inner-div">
            <label>Application Type</label>
            <p>{{ data.serviceRegistration.connectionType =='null'?'-':data.serviceRegistration.connectionType }}</p>
          </div>
          <div class="inner-div">
            <label>Tariff Classification & Nature of Services</label>
            <p>{{ data.serviceRegistration.tariff === "null"?'-':data.serviceRegistration.tariff  }}</p>
          </div>
        </div>
        <div>
          <div class="inner-div">
            <label>Service Category</label>
            <p>Others</p>
          </div>
          <div class="inner-div">
            <label>Applied Load (KW)</label>
            <p>{{ data.serviceRegistration.loadKw }}</p>
          </div>
          <div class="inner-div">
            <label>Applied Load (HP)</label>
            <p>{{ data.serviceRegistration.loadHp }}</p>
          </div>
          <div class="inner-div">
            <label>Total Load / Phase</label>
            <p>
              {{ data.serviceRegistration.totalContractedLoad =='null'?'-':data.serviceRegistration.totalContractedLoad}}
              {{ data.serviceRegistration.loadUnit =='null'?'-':data.serviceRegistration.loadUnit}} /
              {{ data.serviceRegistration.phase=='null'?'-':data.serviceRegistration.phase }} Phase
            </p>
          </div>
          <div class="inner-div">
            <label>Location Type</label>
            <p>{{ data.serviceRegistration.officeName }}</p>
          </div>
          <div class="inner-div">
            <label>Adjacent Account ID</label>
            <p>{{ data.serviceRegistration.serviceRegistrationId }}</p>
          </div>
          <div class="inner-div">
            <label>Buildup Area :</label>
            <p>{{ data.serviceRegistration.buildupAreaSize ==='null'?'-':data.serviceRegistration.buildupAreaSize}}</p>
          </div>
        </div>
      </div>
      <ng-template #bmrContent>
        <div class="two-row-grid mt-4">
        <div class="inner-div">
          <label>Case ID :</label>
          <p>{{ data.serviceRegistration.referenceNumber }}</p>
        </div>
        <div class="inner-div">
          <label>Application Type :</label>
          <p>{{ data.serviceRegistration.applicationType }}</p>
        </div>
      </div>
      </ng-template>
    </div>
    <!-- Cost estimation report  -->
    <div
      class="heading"
      style="
        /* display: flex; */
        align-items: baseline;
        flex-wrap: wrap;
        gap: 2rem;
      "
    >
      <h2>Estimate Details</h2>
    </div>
    <div class="two-row-grid  mt-3">
      <div class="left-div" *ngFor="let item of data.estimationRegisteredDTO">
        <div class="inner-div">
          <label>Dop Category</label>
          <p>{{ workCategoryName ? workCategoryName : '-' }}
          </p>
        </div>
        <div class="inner-div">
          <label>Work Execution Method</label> 
          <p>{{ getWorkExecutionName(item.workExecutionMethod) }}</p>
        </div>
        <div class="inner-div">
          <label>Estimation No</label>
          <p>{{ item.estimationNo }}</p>
        </div>
        <div class="inner-div">
          <label>Estimation Date</label>
          <p>{{ item.estimationDate | date : "medium" }}</p>
        </div>
        <div class="inner-div">
          <label>Purpose of Estimate</label>
          <p>{{ item.estimationWorkDesc }}</p>
        </div>
        <div class="inner-div">
          <label>Certification</label>
          <p>{{ item.estCertificate }}</p>
        </div>
        <div class="inner-div">
          <label>Report</label>
          <p>{{ item.estReport }}</p>
        </div>
      </div>
    </div>

    <!-- LT-Part A -Extension of LT line  -->

    <div *ngIf="regularArray.length" >
      <h2>Regular</h2>
      <div class="heading mt-2" *ngFor="let e of regularArray">
        <div >
          <h1>
            {{ e.estimate.workType }}- {{ e.estimate.workPart }}-
            {{ e.estimate.workscopeDescription }}
          </h1>
        </div>

        <div style="display: flex; flex-wrap: wrap; overflow: auto">
          <table
            class="table text-center"
            style="margin-top: -0.5rem; width: 100%; flex-wrap: wrap"
          >
            <thead>
              <tr>
                <th scope="col">Rate Type</th>
                <th scope="col">Description of Material</th>
                <th scope="col">Quantity</th>
                <th scope="col">Unit</th>
                <th scope="col">Rate</th>
                <th scope="col">Material Amount</th>
                <th scope="col">Labour Rate</th>
                <th scope="col">Labour Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of e.data">
                <td>{{ item.rateType }}</td>
                <td style="text-align: left">
                  {{ item.materialCode }} - {{ item.materialName }}
                </td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.materialUnit }}</td>
                <td>{{ item.materialRate }}</td>
                <td>{{ item.materailAmount }}</td>
                <td>{{ item.labourRate }}</td>
                <td>{{ item.labourAmount }}</td>
              </tr>
            </tbody>
            <tr>
              <td>
                <h4><strong>Total</strong></h4>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>{{ e.estimate.materialCost }}</td>
              <td></td>
              <td>{{ e.estimate.labourCost }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <div *ngIf="creditArray.length" >
      <h2>Credit</h2>
      <div class="heading mt-2" *ngFor="let e of creditArray; index as i">
        <div class="row">
          <div class="col">
            <h1>
              {{ e.estimate.workType }}- {{ e.estimate.workPart }}-
              {{ e.estimate.workscopeDescription }}
            </h1>
          </div>
          <p *ngIf="!e.estimate.isSelectAccountHead">Code : {{ getAccountHeadDetails(e.estimate.accountHeadMasterId)?.accountHeadCode }}</p>
          <p *ngIf="!e.estimate.isSelectAccountHead">Description : {{ getAccountHeadDetails(e.estimate.accountHeadMasterId)?.accountHeadDescription }}</p>
        </div>

        <div style="display: flex; flex-wrap: wrap; overflow: auto">
          <table
            class="table text-center"
            style="margin-top: -0.5rem; width: 100%; flex-wrap: wrap"
          >
            <thead>
              <tr>
                <th scope="col">Rate Type</th>
                <th scope="col">Description of Material</th>
                <th scope="col">Quantity</th>
                <th scope="col">Unit</th>
                <th scope="col">Rate</th>
                <th scope="col">Materials Amount</th>
                <th scope="col">Labour Rate</th>
                <th scope="col">Labour Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of e.data">
                <td>{{ item.rateType }}</td>
                <td style="text-align: left">{{ item.materialCode }} - {{ item.materialName }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.materialUnit }}</td>
                <td>{{ item.materialRate }}</td>
                <td>{{ item.materailAmount }}</td>
                <td>{{ item.labourRate }}</td>
                <td>{{ item.labourAmount }}</td>
              </tr>
            </tbody>
            <tr>
              <td><h1>Total</h1></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>{{ e.estimate.materialCost }}</td>
              <td></td>
              <td>{{ e.estimate.labourCost }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <!-- Typical Cost Data Sheet -->
    <div class="col-lg-6 mt-4" style="width: 100% !important; ">
      <div class="heading">
        <h2>Typical Cost Data Sheet</h2>
      </div>

      <div class="two-row-grid mt-3" style="grid-template-columns: 1fr;justify-items: flex-end;">
        <div class="data-sheet">
          <div class="inner-div-t" *ngIf="data.estimationRegisteredDTO[0]?.woExecutionMethodCode=== 'PT'">
            <label>Escom Material Cost(A)</label>
            <p>
              {{ data.estimationRegisteredDTO[0]?.escomMaterialCost }}
            </p>
          </div>
          <div class="inner-div-t" *ngIf="data.estimationRegisteredDTO[0]?.woExecutionMethodCode=== 'PT'">
            <label>Agency Material Cost (A)</label>
            <p>
              {{ data.estimationRegisteredDTO[0]?.agencyMaterialCost }}
            </p>
          </div>
          <div class="inner-div-t">
            <label>Material Cost(A)</label>
            <p>
              {{ data.estimationRegisteredDTO[0]?.estimationMaterialCost }}
            </p>
          </div>
          <div class="inner-div-t">
            <label>Labour Cost(B)</label>
            <p>
              {{ data.estimationRegisteredDTO[0]?.estimationLabourCost }}
            </p>
          </div>
          <div class="inner-div-t">
            <label>Basic Rate (C)=(A+B)</label>
            <p>
              {{basicRate}}
            </p>
          </div>
          <div class="inner-div-t" *ngFor="let item of addChargesBeforeTotalLabour">
            <label>
                <ng-container *ngIf="item.chargeType == 'PERCENTAGE'">
                    {{ item.chargeTypeValue }}% {{ item.additionalChargeName }}
                </ng-container>
                <ng-container *ngIf="item.chargeType == 'FLAT'">
                    {{ item.additionalChargeName }}
                </ng-container>
                <span *ngIf="item.additionalChargeName === 'Area Specific Loading on Basic Rates'">(D)</span>
                <span *ngIf="item.additionalChargeName === 'GST'">(E)</span>
            </label>
            <p>{{ item.amount }}</p>
        </div>     
          <div class="inner-div-t">
            <label>Cost Of Estimate (F) = (C + D + E)</label>
            <p >{{ data.estimationRegisteredDTO[0]?.totalLabourCharges }}</p>
          </div>
          <div class="inner-div-t" *ngFor="let item of addChargesAfterTotalLabour">
            <label *ngIf="item.chargeType == 'PERCENTAGE'">{{ item.chargeTypeValue }}%
              {{ item.additionalChargeName }}</label>
            <label *ngIf="item.chargeType == 'FLAT'">{{
              item.additionalChargeName
              }}</label>
            <p>{{ item.amount }}</p>
          </div>
          <div class="inner-div-t">
            <label><strong>Total Cost of Estimate (F + Sum of all charges below F)</strong></label>
            <p><strong>{{ data?.estimationRegisteredDTO[0]?.estimationTotalCost }}</strong></p>
          </div>
          <div class="inner-div-t" *ngIf="data?.estimationRegisteredDTO[0]?.workCategoryMasterId==6">
            <label><strong>Total DCW Charges</strong>
              <span *ngIf="data?.estimationRegisteredDTO[0]?.govtFlag == 'Y'"><strong>(Government Works)</strong></span>
              <span *ngIf="data?.estimationRegisteredDTO[0]?.govtFlag == 'N'"><strong>(Non Government Works)</strong></span>
            </label>
            <p>
             <strong>{{ data?.estimationRegisteredDTO[0]?.dcwAmount| number: '1.3-3'}}</strong>
            </p>
          </div>
          <div class="inner-div-t" *ngIf="data?.estimationRegisteredDTO[0]?.workCategoryMasterId ==6">
            <label>(Amount in Words)</label>
            <p>
             {{ data?.estimationRegisteredDTO[0]?.dcwAmount |numberToWords }}
            </p>
          </div>
          <div class="inner-div-t" *ngIf="data?.estimationRegisteredDTO[0]?.workCategoryMasterId !==6">
            <label>(Amount in Words)</label>
            <p>{{ data?.estimationRegisteredDTO[0]?.estimationTotalCost|numberToWords }}</p>
          </div>
          <!-- <div class="inner-div-t" *ngIf="data?.serviceRegistration?.connectionCode==='JVS'">
            <label>MSD Amount</label>
            <p>
              {{ data.estimationRegisteredDTO[0]?.msdAmount }}
            </p>
          </div> -->
        </div>
       
      </div>
    </div>

    <!-- Budget Details -->
    <div
      *ngIf="data.accountHeadMasterId"
      class="heading"
      style="
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        padding: 0 2rem;
      "
    >
      <h2>Budget Details</h2>
    </div>
    <p
      *ngIf="
        grandTotal >
        divisionalBudgetData?.totalBudgetAmount -
          divisionalBudgetData?.workOrderIssueAmount
      "
      style="color: red; padding: 0.2rem"
    >
      Total Amount is greater than Balance Amount
    </p>
    <div
      class="col-lg-6 mt-4"
      style="width: 100% !important; padding: 0.5rem"
      *ngIf="data.accountHeadMasterId"
    >
      <div class="grid two-row-grid mt-4">
        <div class="left-div">
          <div class="inner-div">
            <label>Divisional Acc. Head No.*</label>
            <p>-</p>
          </div>
          <div class="inner-div">
            <label>Divisional Acc. Head Description</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.accountHeadDescription }}
            </p>
          </div>
          <div class="inner-div">
            <label>Division Budget Head</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.divisionalBudgetHead }}
            </p>
          </div>
          <div class="inner-div">
            <label>Budget Type</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.budgetWorkType }}
            </p>
          </div>
        </div>
        <div>
          <div class="inner-div">
            <label>Total Budget Amount</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.totalBudgetAmount }}
            </p>
          </div>
          <div class="inner-div">
            <label>Work Order issue Amount</label>
            <p>
              {{ data?.estimationRegisteredDTO[0]?.workOrderIssueAmount }}
            </p>
          </div>
          <div class="inner-div">
            <label>Balance Amount</label>
            <p>
              {{ balanceAmount }}
            </p>
          </div>
        </div>
      </div>
    </div>
    <!-- Labour Details -->
    <div
      class="heading"
      style="
        /* display: flex; */
        flex-direction: row;
        justify-content: space-between;
        /* padding: 0 2rem; */
      "
      *ngIf="labourDetails.length"
    >
      <h2>Labour Details</h2>
    </div>

    <div
      style="
        display: flex;
        flex-wrap: wrap;
        overflow: auto;
      "
      *ngIf="labourDetails.length"
    >
      <table
        class="table text-center"
        style="margin-top: -0.5rem; width: 100%; flex-wrap: wrap"
      >
        <thead>
          <tr>
            <th scope="col">Description of Material</th>
            <th scope="col">Description of Labours</th>
            <th scope="col">Unit</th>
            <th scope="col">Labour Rate</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let labourDetail of labourDetails">
            <td>{{ labourDetail.materialName }}</td>
            <td>{{ labourDetail.labourName }}</td>
            <td>{{ labourDetail.labourUnit }}</td>
            <td>{{ labourDetail.labourRate }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div></div>
    <div  class="text-center mt-4"*ngIf="showButton">
      <button class="btn btn-secondary" (click)="goBack()">
        Back
      </button>
    </div>
    <br /><br />
  </form>
</section>
</div>
</div>